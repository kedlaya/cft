<section xml:id="sec_ideles">
  <title>Id&#xe8;les and class groups</title>
  <introduction>
    <paragraphs>
      <title>Reference</title>
      <p>
        <xref ref="bib-Milne-CFT" />; <xref ref="bib-Neukirch" />, VI.1 and VI.2; <xref ref="bib-Lang" />, VII.
      </p>
    </paragraphs>
    <p>
      We now shift from additive to multiplicative considerations.
    </p>
  </introduction>
  <subsection>
    <title>Id&#xe8;les</title>
    <definition>
      <p>
      Let <m>K</m> be a number field and let <m>\AA_K</m> be the ring of ad&#xe8;les associated to <m>K</m> (<xref ref="def-adeles-K"/>).
      We define the <term>group of id&#xe8;les</term> <m>I_K</m> associated to <m>K</m> as the group of units of the ring <m>\AA_K</m>.
      In other words, an element of <m>I_K</m> is a tuple <m>(\alpha_v)</m>,
      one element of <m>K_v^*</m> for each place <m>v</m> of <m>K</m>,
      such that <m>\alpha_v \in \gotho_{K_v}^*</m> for all but finitely many finite places <m>v</m>.
      </p>
      <p>
      As a set, <m>I_K</m> is the restricted product of the pairs <m>(K_v^*, \{1\})</m> for infinite places <m>v</m> and <m>(K_v, \gotho_{K_v}^*)</m> for finite places <m>v</m>.
      We use this interpretation to give <m>I_K</m> the structure of a locally compact topological group.
      </p>
    </definition>
    <definition>
      <p>
        For <m>S</m> a finite set, let <m>I_{K,S}</m> be the set of <m>x \in I_K</m> for which <m>x_v \in \gotho_{K_v}^*</m> for each finite place <m>v\notin S</m>;
        then <m>I_K = \bigcup_S I_{K,S}</m>.
        By analogy with <xref ref="def-adelic-S-integers"/>, the elements of <m>I_{K,S}</m> can be thought of as <q>adelic <m>S</m>-units</q>.
      </p>
    </definition>
    <remark xml:id="rmk-idele-topology"> 
    <title>Warning</title>
    <p>
      While the embedding of the id&#xe8;le group <m>I_K</m> into the ad&#xe8;le group <m>\AA_K</m> is continuous,
      the restricted product topology on <m>I_K</m> does not coincide with the subspace topology for the embedding!
      For example, each set <m>I_{K,S}</m> is open in <m>I_K</m> but is not the intersection with an open subset of <m>\AA_K</m>.
    </p>
    <p>
      This is a more serious version of the same issue that came up in <xref ref="exer-subspace-top"/>,
      and the same fix applies: namely, identify <m>I_K</m> with <m>\GL_1(\AA_K)</m> and topologize it accordingly (<xref ref="exer-subspace-top-ideles"/>).
    </p>
    </remark>
  </subsection>
  <subsection>
    <title>The id&#xe8;le class group</title>
    <definition>
      <p>
        For each <m>\alpha \in K^*</m>, the principal ad&#xe8;le <m>\alpha \in \AA_K</m> is an id&#xe8;le,
        so we have an embedding <m>K^* \hookrightarrow I_K</m>. We refer to elements of the image of this embedding as <term>principal id&#xe8;les</term>.
        Define the <term>id&#xe8;le class group</term> of <m>K</m> as the quotient
        <m>C_K = I_K/K^*</m> of the id&#xe8;les by the principal id&#xe8;les.
      </p>
    </definition>
      <p>
        The terminology <term>id&#xe8;le class group</term> is justified on account of the following construction.
      </p>
    <definition xml:id="def-ideles-to-ideals-hom">
      <p>
        There is a homomorphism from <m>I_K</m> to the group of fractional ideals of <m>K</m>:
        <me>
          (\alpha_\nu)_\nu \mapsto \prod_{\gothp} \gothp^{v_{\gothp}(\alpha_\gothp)}
        </me>,
        which is continuous for the discrete topology on the group of fractional ideals.
        (Note that we are ignoring the infinite places; that is, this map factors through <m>I_K^{\fin}</m> viewed as a quotient of <m>I_K</m>.)
        By unique factorization of fractional ideals, this homomorphism is surjective; its kernel is precisely <m>I_{K,S}</m> for <m>S</m> the set of infinite places.
      </p>
      <p>
        Under this map, the principal id&#xe8;le corresponding to <m>\alpha \in K</m> maps to the principal ideal generated by <m>\alpha</m>.
        Thus we have a surjection <m>C_K \to \Cl(K)</m> with kernel <m>I_{K,S} K^*/K^*</m>.
      </p>
    </definition>
    <remark xml:id="rmk-open-subgroup-idele">
      <p>
        What are the open subgroups of <m>I_K</m>?
        For each formal product <m>\gothm</m> of places,
        one gets an open subgroup of id&#xe8;les <m>(\alpha_v)_v</m> such that:
        <ol>
          <li>
            <p>
              if <m>v</m> is a real place occurring in <m>\gothm</m>,
              then <m>\alpha_v > 0</m>;
            </p>
          </li>
          <li>
            <p>
              if <m>v</m> is a finite place corresponding to the prime <m>\gothp</m>,
              occurring to the power <m>e</m>,
              then <m>\alpha_v \equiv 1 \pmod{\gothp^e}</m>.
            </p>
          </li>
        </ol>
        This then projects to an open subgroup of <m>C_K</m>, the quotient by which is the ray class group of modulus <m>\gothm</m>!
        (Here we are using the fact that any element of <m>C_K</m> can be represented
        by an element of <m>I_K</m> which has trivial valuation at any finite place dividing <m>\gothm</m>.
        See <xref ref="def-second-inequality-analytic"/> for an elaboration of this point.)
      </p>
      <p>
        Consequently, the quotients of <m>C_K</m> by open subgroups are isomorphic to (and in bijection with) the generalized ideal class groups,
        with the added convenience that they are all quotients of <em>one</em> group (not a group that depends on <m>\gothm</m>).
        This correspondence is what will allow us to translate between the classical and adelic versions of Artin reciprocity.
      </p>
    </remark>
  </subsection>
  <subsection>
    <title>Compactness and consequences</title>
    <definition xml:id="def-idele-class-norm">
    <p>
      By the product formula (<xref ref="prop-product-formula"/>), we get a well-defined norm map <m>|\cdot|: C_K \to \RR^*_+</m>.
      Let <m>C_K^0</m> be the kernel of the norm map;
      then <m>C_K^0</m> also surjects onto <m>\Cl(K)</m>. (The surjection onto <m>\Cl(K)</m> ignores the infinite places,
      so you can adjust there to force norm 1.)
    </p>
    </definition>
    <proposition xml:id="P_idele_group_compact">
      <statement>
        <p>
          The group <m>C_K^0</m> is compact.
        </p>
      </statement>
      <proof>
        <p>
          We first show (see <xref ref="exer-idele-group-compact"/>) that there exists a real number <m>c>1</m> 
          with the following property: every id&#xe8;le of norm <m>1</m> is (multiplicatively) congruent modulo <m>K^*</m> to an id&#xe8;le whose components all have norms in <m>[c^{-1}, c]</m>.
        </p>
        <p>
          The set of id&#xe8;les with each component having norm in <m>[c^{-1}, c]</m> is the product of
          <q>annuli</q>
          in the archimedean places and finitely many of the nonarchimedean places,
          and the group of units in the rest.
          (Most of the nonarchimedean places don't have any absolute values strictly between <m>1</m> and <m>c</m>.)
          This is a compact set,
          the set of id&#xe8;les therein of norm <m>1</m> is a closed subset and so is also compact,
          and the latter set surjects onto <m>C_K^0</m>, so that's compact too.
        </p>
      </proof>
    </proposition>
    <p>
      While <xref ref="P_idele_group_compact"/> may look innocuous, it actually implies two key theorems of algebraic number theory
      which are traditionally proved using the Minkowski lattice construction. (In fact we are really doing the same arguments in
      slightly different language.)
    </p>
    <corollary xml:id="cor-class-group-finite">
      <statement>
        <p>
          The class group <m>\Cl(K)</m> of <m>K</m> is finite.
        </p>
      </statement>
      <proof>
        <p>
          The group <m>C_K^0</m> is compact by <xref ref="P_idele_group_compact"/> and it surjects onto <m>\Cl(K)</m>,
          so the latter must also be compact for the discrete topology, and hence finite.
        </p>
      </proof>
    </corollary>
    <corollary xml:id="lem-generate-ideles-with-S-units">
      <statement>
        <p>
          There exists a finite set <m>S</m> of places of <m>K</m> such that
          <me>
           I_K = I_{K,S} K^*.
          </me>
          In particular, for any such <m>S</m>, <m>C_K</m> is a quotient of <m>I_{K,S}</m>.
        </p>
      </statement>
      <proof>
        <p>
          Since <m>\Cl(K) = I_L/K^*</m> is finite, it is generated by some finite set of primes.
          By taking <m>S</m> to include the corresponding places, we achieve the desired effect.
        </p>
      </proof>
    </corollary>
    <corollary xml:id="cor-S-units-theorem">
      <title>Dirichlet's units theorem</title>
      <statement>
          <p>
            The group of units of <m>\gotho_K</m> fits into an exact sequence
            <me>
              0 \to \mu_K \to \gotho_K^* \to \ZZ^{r+s-1} \to 0
            </me>
            in which <m>\mu_K</m> is the (finite cyclic) group of roots of unity of <m>K</m> and
            <m>r</m> and <m>s</m> are the number of real and complex places, respectively.
            More generally, for any finite set <m>S</m> of places containing all infinite places, the group of units of the ring 
            <m>\gotho_{K,S}</m> of <m>S</m>-integers fits into an exact sequence
            <me>
              0 \to \mu_K \to \gotho_{K,S}^* \to \ZZ^{\#S-1} \to 0.
            </me>
          </p>
      </statement>
      <proof>
        <p>
          Define the map <m>\log: I_{K,S} \to \RR^{\#S}</m> by taking log of the absolute value of the norm of each component in <m>S</m>
          (normalizing as in <xref ref="def-normalized-adele-norm"/>).
          By the product formula (<xref ref="prop-product-formula"/>),
          this map carries <m>\gotho_{K,S}^*</m> into the trace-zero hyperplane <m>H</m> in <m>\RR^{\#S}</m>.
          By Kronecker's theorem, any algebraic number with trivial valuation at all finite and infinite places
          must be a root of unity, so the kernel of <m>\gotho_{K,S}^* \to H</m> equals <m>\mu_K</m>.
        </p>
        <p>
          Restricting an element of <m>\gotho_{K,S}^*</m> to a bounded subset of <m>H</m> bounds all of its absolute values.
          Hence the discreteness of <m>K</m> in <m>\AA_K</m> (<xref ref="cor-adeles-discrete"/>) implies that 
          the image of the group <m>\gotho_{K,S}^*</m> is discrete in <m>H</m>.
        </p>
        <p>
          Let <m>W</m> be the span in <m>H</m> of the image of <m>\gotho_{K,S}^*</m>;
          it remains to check that <m>W = H</m>, as this will imply that <m>\gotho_{K,S}^*</m> is a lattice in <m>H</m>
          and hence has rank <m>\dim H = \#S - 1</m>.
          We may check this after enlarging <m>S</m>; by <xref ref="lem-generate-ideles-with-S-units"/>, we can assume that <m>I_{K,S} K^* = I_K</m> and hence
          <me>
            C_K = I_K/K^* \cong I_{K,S} / \gotho_{K,S}^*.
          </me>
          Using this isomorphism, we obtain a continuous homomorphism <m>C_K^0 \to H/W</m> whose image generates <m>H/W</m>.
          Since <m>C_K^0</m> is compact (<xref ref="P_idele_group_compact"/>), so is its image; 
          this is a contradiction unless <m>H/W</m> is the zero vector space.
          Thus 
        </p>
      </proof>
    </corollary>
    <remark xml:id="rmk-idele-group-presentation-for-Q">
      <p>
        One corollary of the proof of <xref ref="cor-class-group-finite"/> is that the component group of <m>C_K</m>
        surjects onto <m>\Cl(K)</m>, and hence is nontrivial in general.
      </p>
      <p>
        This of course does not say anything in the case <m>K=\QQ</m>, and in this case one can give a more direct description of <m>C_K</m>.
        Namely, given an arbitrary id&#xe8;le in <m>I_\QQ</m>,
        there is a unique positive rational with the same norms at the finite places.
        Thus
        <me>
          C_\QQ \cong \RR^+ \times \prod_p \ZZ_p^*
        </me>.
       </p>
       <p>
         Returning to the case of general <m>K</m>, there is a natural way to define a volume measure on <m>C_K</m> in such a way that the volume of the kernel of
         <m>C^0_K \to \Cl(K)</m> is exactly the unit regulator of <m>K</m>. Consequently, the total volume of <m>C^0_K</m> equals the product of the class number
         and the unit regulator, and it is this product which shows up in the analytic class number formula (based on the residue of the Dedekind zeta function
         of <m>K</m> at the point <m>s=1</m>; see <xref ref="thm-adelic-zeta"/>).
       </p>
    </remark>
  </subsection>
  <subsection>
    <title>Aside: beyond class field theory</title>
    <remark xml:id="rmk-beyond-CFT">
    <p>
      Via the identification <m>I_K \cong \GL_1(\AA_K)</m> from <xref ref="rmk-idele-topology"/>, 
      class field theory can be viewed as a correspondence between one-dimensional representations of
      <m>\Gal(\overline{K}/K)</m> and certain representations of <m>\GL_1(\AA_K)</m>.
      This is the form in which class field theory generalizes to the nonabelian case:
      the Langlands program predicts a correspondence between <m>n</m>-dimensional representations of
      <m>\Gal(\overline{K}/K)</m> and certain representations of <m>\GL_n(\AA_K)</m>.
      See <xref ref="sec_parting"/> for further discussion.
    </p>
  </remark>
  </subsection>
  <exercises>
    <title>Exercises</title>
      <exercise xml:id="exer-subspace-top-ideles">
        <statement>
          Show that the restricted direct product topology on <m>I_K</m> is the subspace topology for the embedding into
          <m>\AA_K \times \AA_K</m> given by the map <m>x \mapsto (x,x^{-1})</m>, and moreover this embedding has closed image.
        </statement>
      </exercise>
      <exercise xml:id="exer-idele-group-compact">
        <statement>
          Complete the proof of <xref ref="P_idele_group_compact"/> by establishing the existence of the constant <m>c</m>.
          This can be done using the finiteness of the class group (<xref ref="cor-class-group-finite"/>) or the units theorem (<xref ref="cor-S-units-theorem"/>);
          alternatively, with more work one can give a direct proof via which both of the aforementioned results become corollaries of <xref ref="P_idele_group_compact"/>.
        </statement>
        <hint>
          For the direct approach, see for example <xref ref="bib-Lang"/>, Section V.1, Theorem 0.
        </hint>
      </exercise>
  </exercises>
</section>
