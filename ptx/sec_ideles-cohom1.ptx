<section xml:id="sec_ideles-cohom1">
  <title>Cohomology of the id&#xe8;les I: the
  <q>First Inequality</q>
  </title>
  <introduction>
    <paragraphs>
      <title>Reference</title>
      <p>
        <xref ref="bib-Milne-CFT"/> VII.2-VII.4; <xref ref="bib-Neukirch"/> VI.3, but see below.
      </p>
    </paragraphs>
    <p>
      By analogy with local class field theory,
      we want to prove that for <m>K,L</m> number fields and
      <m>C_K, C_L</m> their id&#xe8;le class groups,
      <me>
        H^1(\Gal(L/K), C_L) = 1, \qquad H^2(\Gal(L/K), C_L) = \ZZ/[L:K]\ZZ
      </me>.
    </p>
    <p>
      In this chapter,
      we'll look at the special case <m>L/K</m> cyclic, and prove the following.
    </p>
    <theorem xml:id="T_first_inequality1">
      <statement>
        <p>
          For <m>L/K</m> a cyclic extension of number fields,
         <me>
          h(C_L) = [L:K].
         </me>
        </p>
      </statement>
      <proof>
        <p>
          This will follow by combining <xref ref="cor-idele-cohomology-local"/>, <xref ref="def-idele-S-units-Herbrand"/>, and <xref ref="lem-Herbrand-S-units"/>.
        </p>
      </proof>
    </theorem>
    <p>
      As we'll see,
      this will end up reducing to looking at units in a real vector space,
      much as in the proof of Dirichlet's units theorem.
    </p>
    <p>
      This will imply the so-called <q>First Inequality</q>.
    </p>
    <theorem xml:id="T_first_inequality">
      <title>First Inequality</title>
      <statement>
        <p>
          For <m>L/K</m> a cyclic extension of number fields,
          <me>
            \#H^0_T(\Gal(L/K), C_L) \geq [L:K]
          </me>.
        </p>
      </statement>
      <proof>
        Apply <xref ref="T_first_inequality1"/> and remember that <m>\#H^1_T(\Gal(L/K), C_L) \geq 1</m>.
      </proof>
    </theorem>
    <p>
      The
      <q>Second Inequality</q>
      will be the reverse, which will be a bit more subtle
      (see <xref ref="T_first_and_second_inequality"/>).
    </p>
  </introduction>
  <subsection>
    <title>Some basic observations</title>
    <definition>
      <p>
        Let <m>L/K</m> be a Galois extension of number fields with Galois group <m>G</m>.
        (We do not yet need <m>G</m> to be cyclic.)
        For any finite set <m>S</m> of places of <m>K</m> containing all infinite places and all ramified primes,
        let <m>I_{L,S}</m> be the set of id&#xe8;les with a unit at each component other than at the places dividing any places in <m>S</m>.
        Note that <m>I_{L,S}</m> is stable under <m>G</m>
        (because we defined it in terms of places of <m>K</m>, not <m>L</m>).
        By definition,
        <m>I_L</m> is the direct limit of the <m>I_{L,S}</m> over all <m>S</m>.
      </p>
    </definition>
    <proposition xml:id="prop-idele-cohomology-local">
      <statement>
        <p>
          Let <m>L/K</m> be a Galois extension of number fields with Galois group <m>G</m>.
          For each <m>i>0</m>, <m>H^i(G, I_L) = \bigoplus_v H^i(G_v, L_v^*)</m>.
          For each <m>i</m>, <m>H^i_T(G, I_L) = \bigoplus_v H^i_T(G_v, L_v^*)</m>.
        </p>
      </statement>
    <proof>
      <p>
        Since <m>I_L</m> is the direct limit of the <m>I_{L,S}</m> over all <m>S</m>,
        <m>H^i(G,I_L)</m> is the direct limit of the <m>H^i(G, I_{L,S})</m>.
        The latter is the product of
        <m>H^i(G, \prod_{w|v} L_w^*)</m> over all <m>v \in S</m> and
        <m>H^i(G, \prod_{w|v} \gotho_{L_w}^*)</m> over all <m>v \notin S</m>,
        but the latter is trivial because <m>v \notin S</m> cannot ramify.
        By Shapiro's lemma (<xref ref="L_Shapiro"/>),
        <m>H^i(G, \prod_{w|v} L_w^*) = H^i(G_v, L_w^*)</m>, so we have what we want.
        The argument for Tate groups is analogous.
      </p>
    </proof>
    </proposition>
    <corollary xml:id="cor-idele-cohomology-local">
      <statement>
        <p>
          Let <m>L/K</m> be a Galois extension of number fields with Galois group <m>G</m>. Then
          <me>
            H^1(G, I_L) = 0, \qquad H^2(G, I_L) = \bigoplus_v \frac{1}{[L_w:K_v]} \ZZ/\ZZ.
          </me>
        </p>
      </statement>
      <proof>
        <p>
          This follows by combining <xref ref="prop-idele-cohomology-local"/> with the computation of cohomology of local fields
          (<xref ref="L_theorem_90"/> and <xref ref="P_local_h2"/>).
        </p>
      </proof>
    </corollary>
    <remark>
    <p>
      As a sanity check, note that the case <m>i=0</m> of <xref ref="prop-idele-cohomology-local"/> asserts something that is evidently true:
      an id&#xe8;le in <m>I_K</m>is a norm from <m>I_L</m> if and only if each component is a norm.
    </p>
    </remark>
    <remark>
      <p>
      If <m>S</m> contains all infinite places and all ramified places, then
      <me>
        \Norm_{L/K} I_{L,S} = \prod_{v \in S} U_v \times \prod_{v \notin S} \gotho_{K_v}^*
      </me>
      where <m>U_v</m> is open in <m>K_v^*</m>.
      The group on the right is open in <m>I_K</m>, so <m>\Norm_{L/K} I_K</m> is open.
      </p>
      <p>
        By quotienting down to <m>C_K</m>, we see that <m>\Norm_{L/K} C_K</m> is open.
        In fact, the snake lemma on the diagram
      </p>
      <figure xml:id="fig-ideles-cohom1-1">
      <image>
      <latex-image>
      \xymatrix{
      0 \ar[r] &amp; L^* \ar[r] \ar^{\Norm_{L/K}}[d] &amp; I_L \ar[r] \ar^{\Norm_{L/K}}[d] &amp; C_L \ar[r] \ar^{\Norm_{L/K}}[d] &amp; 0 \\
      0 \ar[r] &amp; K^* \ar[r] &amp; I_K \ar[r] &amp; C_K \ar[r] &amp; 0
      }
      </latex-image>
      </image>
      </figure>
      <p>
        implies that the quotient <m>I_K/(K^* \times \Norm_{L/K} I_L)</m> is isomorphic to <m>C_K</m>.
      </p>
    </remark>
  </subsection>
  <subsection>
    <title>Cohomology of the units: first steps</title>
    <p>
      We now
      Remember, we're going to be assuming
      <m>G = \Gal(L/K)</m> is cyclic until further notice,
      so that we may use periodicity of the Tate groups,
      and the Herbrand quotient.
    </p>
    <p>
      We first observe that we can replace <m>I_L</m> with <m>I_{L,S}</m> for some conveniently large set of places <m>S</m>.
    </p>
    <lemma xml:id="lem-generate-ideles-with-S-units">
      <statement>
        <p>
          Let <m>L/K</m> be a Galois extension of number fields with Galois group <m>G</m>.
          Then there exists a finite set <m>S</m> of places of <m>K</m> such that
          <me>
           I_L = I_{L,S} L^*.
          </me>
          In particular, for any such <m>S</m>, <m>C_L</m> is a quotient of <m>I_{L,S}</m>.
        </p>
      </statement>
      <proof>
        <p>
          Since <m>\Cl(L) = I_L/L^*</m> is finite, it is generated by some finite set of primes.
          By ensuring that each of these lies over a finite place in <m>S</m>, we achieve the desired effect.
        </p>
      </proof>
    </lemma>
    <remark>
      <p>
        The proof of <xref ref="lem-generate-ideles-with-S-units"/> can also be used to prove that <m>C^0_L</m> is compact
        (<xref ref="P_idele_group_compact"/>), except that one cannot then deduce the finiteness of the ideal class group as a corollary (as this would be circular).
      </p>
    </remark>
    <definition xml:id="def-idele-S-units-Herbrand">
    <p>
      Let <m>L/K</m> be a cyclic extension of number fields.
      For some <m>S</m> as in <xref ref="lem-generate-ideles-with-S-units"/>, let <m>L_S = L^* \cap I_{L,S}</m> be the group of <term><m>S</m>-units</term> in <m>L</m>.
      From the exact sequence
      <me>
        1 \to L_S \to I_{L,S} \to I_{L,S}/L_S = C_L \to 1
      </me>
      we have an equality of Herbrand quotients
      <me>
        h(C_L) = h(I_{L,S})/h(L_S).
      </me>
    </p>
    <p>
      By <xref ref="cor-idele-cohomology-local"/>, we may compute the Herbrand quotient
      <me>
        h(I_{L,S}) = \prod_{v \in S} \#H^0_T(G_v, L_w^*)= \prod_{v \in S} [L_w:K_v].
      </me>
    </p>
    <p>
      To get <m>h(C_L) = [L:K]</m>, we thus need the equality
      <me>
        h(L_S) = \frac{1}{[L:K]} \prod_{v \in S} [L_w:K_v].
      </me>.
    </p>
    <p>
      This will in fact be true even if we only assume <m>S</m> contains all infinite places,
      as we check below (<xref ref="lem-Herbrand-S-units"/>).
    </p>
    </definition>
    </subsection>
    <subsection>
    <title>Cohomology of the units: a computation with <m>S</m>-units</title>
    <p>
      At this point, we have reduced the computation of the Herbrand quotient <m>h(I_L)</m>, and by extension the First Inequality,
      to the computation of <m>h(L_S)</m> for a suitable set <m>S</m> of places of <m>K</m>. We treat this point next, using similar
      ideas to the proof of Dirichlet's units theorem.
    </p>
    <lemma xml:id="lem-Herbrand-S-units">
      <statement>
        <p>
          Let <m>L/K</m> be a finite cyclic extension of number fields.
          Let <m>S</m> be a finite set of places of <m>K</m> containing all infinite places. Then
          <me>
            h(L_S) = \frac{1}{[L:K]} \prod_{v \in S} [L_w:K_v].
          </me>
        </p>
      </statement>
      <proof>
        <p>
          See the calculations in <xref ref="def-Herbrand-quotient-real-lattices1"/> and <xref ref="def-Herbrand-quotient-real-lattices2"/>,
          plus <xref ref="lem-Herbrand-quotient-real-lattices"/>.
        </p>
      </proof>
    </lemma>
    <definition xml:id="def-Herbrand-quotient-real-lattices1">
        <p>
          With notation as in <xref ref="lem-Herbrand-S-units"/>, let <m>T</m> be the set of places of <m>L</m> dividing the places of <m>S</m>.
          Let <m>V</m> be the real vector space consisting of one copy of <m>\RR</m> for each place in <m>T</m>.
          Define the map <m>L_S \to V</m> by sending
          <me>
            L_S \to V, \qquad \alpha \to \prod_{w \in T} \log |\alpha|_w
          </me>
          with normalizations as in <xref ref="def-normalized-adele-norm"/>;
          by Kronecker's theorem (any algebraic integer whose conjugates in <m>\CC</m> all have norm 1 is a root of unity),
          the kernel of this map consists of roots of unity.
        </p>
        <p>
          Let <m>M</m> be the image of <m>L_S</m> in <m>V</m>;
          since the kernel of <m>L_S \to V</m> is finite, we have <m>h(M) = h(L_S)</m>.
          Let <m>H \subset V</m> be the hyperplane of vectors with sum of coordinates 0;
          by the product formula (<xref ref="prop-product-formula"/>), <m>M</m> maps into <m>H</m>.
          By Dirichlet's units theorem (<xref ref="cor-S-units-theorem"/>), <m>M</m> is a lattice in <m>H</m>;
          moreover, we have an action of <m>G</m> on <m>V</m> compatible with the embedding of <m>M</m>:
          <m>G</m> acts on the places in <m>T</m>, so it acts on <m>V</m> by permuting the coordinates.
        </p>
    </definition>
    <remark>
    <title>Caveat</title>
    <p>
      At this point, we deviate from <xref ref="bib-Neukirch"/> due to an error therein.
      Namely, Lemma VI.3.4 is only proved assuming that <m>G</m> acts transitively on the coordinates of <m>V</m>,
      but in <xref ref="def-Herbrand-quotient-real-lattices1"/> this is not the case:
      <m>G</m> permutes the places above any given place <m>v</m> of <m>K</m> but those are separate orbits.
      So we'll follow <xref ref="bib-Milne-CFT"/> instead.
    </p>
    </remark>
    <definition xml:id="def-Herbrand-quotient-real-lattices2">
    <p>
      Continuing from <xref ref="def-Herbrand-quotient-real-lattices1"/>,
      we can write down two natural lattices in <m>V</m>.
      One of them is the lattice generated by <m>M</m> together with the all-ones vector,
      on which <m>G</m> acts trivially.
      As a <m>G</m>-module,
      the Herbrand quotient of that lattice is <m>h(M) h(\ZZ) = [L:K] h(M)</m>.
      The other is the lattice <m>M'</m> in which,
      in the given coordinate system,
      each element has integral coordinates.
      To compute its Herbrand quotient,
      notice that the projection of this lattice onto the coordinates corresponding to the places <m>w \in T</m> above some <m>v \in S</m> form a copy of <m>\Ind^G_{G_v} \ZZ</m>.
      Thus
      <me>
        h(G, M') = \prod_{v \in S} h(G, \Ind^G_{G_v} \ZZ) = \prod_{v \in S} h(G_v, \ZZ) = \prod_{v \in S} \#G_v = \prod_{v \in S} [L_w:K_v].
      </me>
      </p>
    </definition>
    <p>
      To sum up, the calculations from <xref ref="def-Herbrand-quotient-real-lattices1"/> and <xref ref="def-Herbrand-quotient-real-lattices2"/>
      reduce <xref ref="lem-Herbrand-quotient-real-lattices"/> to the following statement (<xref ref="lem-Herbrand-quotient-real-lattices"/>).
    </p>
    </subsection>
    <subsection>
    <title>Herbrand quotients of real lattices</title>
    <p>
      We conclude the proof of the First Inequality with the following statement.
    </p>
    <lemma xml:id="lem-Herbrand-quotient-real-lattices">
      <statement>
        <p>
          Let <m>V</m> be a real vector space on which a finite group <m>G</m> acts linearly,
          and let <m>L_1</m> and <m>L_2</m> be <m>G</m>-stable lattices in <m>V</m> for which at least one of <m>h(L_1)</m> and <m>h(L_2)</m> is defined.
          Then <m>h(L_1) = h(L_2)</m> (and both are defined).
        </p>
      </statement>
    <proof>
      <p>
        We first show that <m>L_1 \otimes_{\ZZ} \QQ</m> and
        <m>L_2 \otimes_{\ZZ} \QQ</m> are isomorphic as <m>\QQ[G]</m>-modules.
        We are given that <m>L_1 \otimes_{\ZZ} \RR</m> and
        <m>L_2 \otimes_{\ZZ} \RR</m> are isomorphic as <m>\RR[G]</m>-modules.
        That is, the real vector space <m>W = \Hom_{\RR}(L_1 \otimes_{\ZZ} \RR, L_2 \otimes_{\ZZ} \RR)</m>,
        on which <m>G</m> acts by the formula <m>T^g(x) = T(x^{g^{-1}})^g</m>,
        contains an invariant vector which,
        as a linear transformation, is invertible.
        Now <m>W</m> can also be written as
        <me>
          \Hom_{\ZZ}(L_1, L_2) \otimes_{\ZZ} \RR;
        </me>
        that is, <m>\Hom_{\ZZ}(L_1, L_2)</m> sits inside as a sublattice.
        The fact that <m>W</m> has an invariant vector says that a certain set of linear equations has a nonzero solution over <m>\RR</m>,
        namely the equations that express the fact that the action of <m>G</m> leaves the vector invariant.
        But those equations have coefficients in <m>\QQ</m>,
        so there must already be invariant vectors over <m>\QQ</m>.
        Moreover, if we fix an isomorphism
        (not <m>G</m>-equivariant)
        between <m>L_2 \otimes_{\ZZ} \RR</m> and <m>L_1 \otimes_{\ZZ} \RR</m>,
        we can compose this with any element of <m>W</m> to get a map from <m>L_1</m> to itself,
        which has a determinant;
        and by hypothesis,
        there is some invariant vector of <m>W</m> whose determinant is nonzero.
        Thus the determinant doesn't vanish identically on the set of invariant vectors in <m>W</m>,
        so it also doesn't vanish identically on the set of invariant vectors in <m>\Hom_{\ZZ}(L_1, L_2) \otimes_{\ZZ} \QQ</m>.
      </p>
      <p>
        Thus there is a <m>G</m>-equivariant isomorphism between
        <m>L_1 \otimes_{\ZZ} \QQ</m> and <m>L_2 \otimes_{\ZZ} \QQ</m>;
        that is, <m>L_1</m> is isomorphic to a sublattice of <m>L_2</m>.
        Since a lattice has the same Herbrand quotient as any sublattice
        (the quotient is finite, so its Herbrand quotient is 1),
        that means <m>h(L_1) = h(L_2)</m>.
      </p>
    </proof>
    </lemma>
  </subsection>
  <subsection>
    <title>Splitting of primes</title>
    <p>
      As a consequence of the First Inequality,
      we record the following fact which was previously stated as a consequence of the Chebotar&#xeb;v density theorem 
      (<xref ref="T_Chebotarev"/>), but which will be needed logically earlier in the arguments. (See <xref ref="bib-Neukirch"/>, Corollary VI.3.8 for more details.)
    </p>
    <corollary xml:id="C_split_completely">
      <statement>
        <p>
          For any nontrivial extension <m>L/K</m> of number fields,
          there are infinitely many primes of <m>K</m> which do not split completely in <m>L</m>.
        </p>
      </statement>
    <proof>
      <p>
        Suppose first that <m>L/K</m> is of prime order.
        If all but finitely many primes split completely,
        we can put the remaining primes into <m>S</m> and deduce that <m>C_K = \Norm_{L/K} C_L</m>,
        whereas <xref ref="T_first_inequality"/> asserts that <m>H^0_T(\Gal(L/K), C_L) \geq [L:K]</m>,
        contradiction.
      </p>
      <p>
        In the general case, let <m>M</m> be the Galois closure of <m>L/K</m>;
        then a prime of <m>K</m> splits completely in <m>L</m> if and only if it splits completely in <m>M</m>.
        Since <m>\Gal(M/K)</m> is a nontrivial finite group,
        it contains a cyclic subgroup of prime order;
        let <m>N</m> be the fixed field of this subgroup.
        By the previous paragraph,
        there are infinitely many prime ideals of <m>N</m> which do not split completely in <m>M</m>,
        proving the original result.
      </p>
    </proof>
    </corollary>
  </subsection>
</section>
