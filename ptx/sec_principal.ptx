<section xml:id="sec_principal">
  <title>The principal ideal theorem</title>
  <introduction>
    <paragraphs>
      <title>Reference</title>
      <p>
        <xref ref="bib-Milne-CFT"/>, section V.3
        (but you won't find the proofs I've omitted there either);
        <xref ref="bib-Neukirch"/>, section VI.7 (see also IV.5);
        <xref ref="bib-Lang"/>, section XI.5.
      </p>
    </paragraphs>
  </introduction>
  <subsection>
    <title>Statement of the theorem</title>
    <p>
      For a change, we're going to prove something, although the proof will depend on the Artin reciprocity law which we haven't proved.
      Or rather, we're going to sketch a proof that you will get to fill in by doing the exercises. (Why should I have all the fun?)
    </p>
    <p>
      The following theorem is due to Furtw&#xe4;ngler, a student of Hilbert.
      (It's also called the <q>capitulation</q> theorem, because the word <q>capitulate</q> was formerly used to mean <q>to become principal</q>. 
      Etymology left to the reader.)
    </p>
    <theorem xml:id="T_principal_ideal_theorem">
      <title>Principal ideal theorem</title>
      <statement>
        <p>
          Let <m>L</m> be the Hilbert class field of the number field <m>K</m>.
          Then every ideal of <m>K</m> becomes principal in <m>L</m>.
        </p>
      </statement>
      <proof>
        <p>
          This will follow by combining <xref ref="T_transfer_homomorphism"/> (construction of the transfer homomorphism),
          <xref ref="L_transfer_Frobenius"/> (implication that vanishing of the transfer homomorphism implies the desired result), and
          <xref ref="T_transfer_vanishes"/> (vanishing of the transfer homomorphism).
        </p>
      </proof>
    </theorem>
    <example>
      <p>
        If <m>K = \QQ(\sqrt{-5})</m>,
        then <m>L = \QQ(\sqrt{-5}, \sqrt{-1})</m>,
        and the nonprincipal ideal class of <m>K</m> is represented by <m>(2, 1+\sqrt{-5})</m>,
        which is generated by <m>1+\sqrt{-1}</m> in <m>L</m>.
      </p>
    </example>
  </subsection>
  <subsection>
    <title>First steps of the proof</title>
    <p>
      The idea of the proof is to apply Artin reciprocity to reduce to a problem purely in finite group theory, which we then solve.
      To this end, let <m>M</m> be the Hilbert class field of <m>L</m>;
      then an ideal of <m>L</m> is principal if and only if its image under the Artin map <m>J_L \to \Gal(M/L)</m> is trivial.
      So our first step will be to give a purely group-theoretic description of the map <m>V: \Gal(L/K) \to \Gal(M/L)</m>
      corresponding to the extension homomorphism <m>\Cl(K) \to \Cl(L)</m> (i.e., making the diagram in <xref ref="fig-principal-1"/> commute,
      in which the horizontal arrows are Artin maps).
    </p>
      <figure xml:id="fig-principal-1">
        <image xml:id="img-principal-1">
        <latex-image>
        \xymatrix{
        \Cl(K) \ar[r] \ar[d] &amp; \Gal(L/K) \ar^{V}[d] \\
        \Cl(L) \ar[r] &amp; \Gal(M/L)
        }
        </latex-image>
        </image>
      </figure>
    <p>
      In order to proceed further, we must extract more information about the Galois groups in question.
      <ol>
        <li>
          <p>
            The extension <m>M/K</m> is unramified because <m>M/L</m> and <m>L/K</m> are.
            It is also Galois: its image under any element of <m>\Gal(\overline{K}/K)</m> is still an unramified abelian extension of <m>L</m>
            and so is contained in <m>M</m>. 
          </p>
        </li>
        <li>
          <p>
            The maximal subextension of <m>M/K</m> which is abelian over <m>K</m> is equal to <m>L</m>.
          </p>
        </li>
      </ol>
    </p>
  </subsection>
  <subsection>
    <title>Translation into group theory</title>
    <definition>
      <p>
        Given a finite group <m>G</m>,
        let <m>G^{\ab}</m> denote the maximal abelian quotient of <m>G</m>;
        that is, <m>G^{\ab}</m> is the quotient of <m>G</m> by its commutator subgroup <m>G'</m>.
        Then the previous discussion implies that <m>\Gal(M/L)</m> is the commutator subgroup of
        <m>\Gal(M/K)</m> and <m>\Gal(M/K)^{\ab} = \Gal(L/K)</m>.
        We may thus relabel <xref ref="fig-principal-1"/> as in <xref ref="fig-principal-2"/>.
      </p>
      <figure xml:id="fig-principal-2">
        <image xml:id="img-principal-2">
        <latex-image>
        \xymatrix{
        \Cl(K) \ar[r] \ar[d] &amp; \Gal(L/K) = \Gal(M/K)^{\ab} \ar^{V}[d] \\
        \Cl(L) \ar[r] &amp; \Gal(M/L) = \Gal(M/L)^{\ab}
        }
        </latex-image>
        </image>
      </figure>
    </definition>
    <p>
      We now give the purely group-theoretic interpretation of the map <m>V</m> in <xref ref="fig-principal-2"/>.
    </p>
    <definition xml:id="def-transfer-homomorphism">
      <p>
        Let <m>G</m> be a finite group and <m>H</m> a (not necessarily normal) subgroup.
        Let <m>g_1, \dots, g_n</m> be left coset representatives of <m>H</m> in <m>G</m>:
        that is, <m>G = g_1H \cup \cdots \cup g_nH</m>.
        For <m>g \in G</m>, put <m>\phi(g) = g_i</m> if
        <m>g \in g_iH</m> (i.e., <m>g_i^{-1}g \in H</m>).
        Put
        <me>
          V(g) = \prod_{i=1}^n \phi(gg_i)^{-1}(gg_i);
        </me>
        then <m>V(g)</m> always lands in <m>H</m>.
      </p>
      <p>
        Now consider what happens when we compose the map <m>g \mapsto V(g): G \to H</m>
        (which is not necessarily a homomorphism) with the projection <m>H \to H^{\ab}</m>.
        It will follow from <xref ref="T_transfer_homomorphism"/> that the resulting map 
        <m>G \to H^{\ab}</m> is a homomorphism which factors through <m>G^{\ab}</m>.
        The induced map <m>V: G^{\ab} \to H^{\ab}</m> is called the <term>transfer map</term>
        (in German <q>Verlagerung</q>, hence the use of the letter <m>V</m> in the notation).
      </p>
    </definition>
    <theorem xml:id="T_transfer_homomorphism">
      <statement>
        <p>
          With notation as in <xref ref="def-transfer-homomorphism"/>,
          the map <m>V: G \to H^{\ab}</m> is a homomorphism;
          it does not depend on the choice of the <m>g_i</m>;
          and induces a homomorphism <m>G^{\ab} \to H^{\ab}</m> (i.e., kills commutators in <m>G</m>).
        </p>
      </statement>
      <proof>
        <p>
          See <xref ref="exc-transfer-homomorphism"/>.
        </p>
      </proof>
    </theorem>
    <remark>
      <p>
        In lieu of establishing <xref ref="T_transfer_homomorphism"/> directly, one can derive it from properties of
        homology of finite groups. See <xref ref="exer-transfer-as-homology"/>.
      </p>
    </remark>
    <p>
      Setting aside the proof of <xref ref="T_transfer_homomorphism"/> for the moment, let's see that this does indeed give the
      correct map in <xref ref="fig-principal-2"/> when we take <m>G = \Gal(M/K)</m> and <m>H = \Gal(M/L)</m>,
      so that <m>G/H = \Gal(L/K)</m>. This amounts to computing what happens when we apply all of the maps starting with a prime
      <m>\gothp</m> of <m>K</m> at the top left of the diagram.
    </p>
    <p>
      Choose a prime <m>\gothq</m> of <m>L</m> over <m>\gothp</m> and a prime <m>\gothr</m> of <m>M</m> over <m>\gothq</m>,
      let <m>G_{\gothr} \subseteq G</m> be the decomposition group of <m>\gothr</m> over <m>K</m> (i.e., the stabilizer of <m>\gothr</m> under the action
      of <m>G</m> on the primes above <m>\gothp</m>), and let <m>g \in G_{\gothr}</m> be the Frobenius of <m>\gothr</m>.
      Keep in mind that since <m>G</m> is not abelian, <m>g</m> depends on the choice of <m>\gothr</m>,
      not just on <m>\gothq</m>; that is, there's no Artin map into <m>G</m>.
    </p>
    <p>
      Let <m>\gothq_1, \dots, \gothq_r</m> be the primes of <m>L</m> above <m>\gothp</m>;
      then the image of <m>\gothp</m> in <m>L</m> is <m>\prod_i \gothq_i</m>,
      and the image of that product under the Artin map is <m>\prod_i \Frob_{M/L}(\gothq_i)</m>.
      To show that this equals <m>V(g)</m>,
      we make a careful choice of the coset representatives <m>g_i</m> in the definition of <m>V</m>.
      Namely, decompose <m>G</m> as a union of double cosets <m>G_{\gothr} \tau_i H</m>.
      Then the primes of <m>L</m> above <m>\gothp</m> correspond to these double cosets,
      where the double coset <m>G_{\gothr} \tau_i H</m> corresponds to <m>L \cap \gothr^{\tau_i}</m>.
      Let <m>m</m> be the order of
      <m>\Frob_{L/K}(\gothp)</m> and write <m>G_{\gothr} \tau_i H = \tau_iH \cup g\tau_i H \cup \cdots \cup g^{m-1}\tau_i H</m> for each <m>i</m>;
      we then use the elements <m>g_{ij} = g^j \tau_i</m> as the left coset representatives to define <m>\phi</m> and <m>V</m>.
      Thus the equality <m>V(g) = \prod_i \Frob_{M/L}(\gothq_i)</m> follows from the following lemma.
    </p>
    <lemma xml:id="L_transfer_Frobenius">
      <statement>
        <p>
          If <m>L \cap \gothr^{\tau_i} = \gothq_i</m>,
          then <m>\Frob_{M/L}(\gothq_i) = \prod_{j=0}^{m-1} \phi(g g_{ij})^{-1} g g_{ij}</m>.
        </p>
      </statement>
      <proof>
        <p>
          See <xref ref="exc-transfer-Frobenius"/>.
        </p>
      </proof>
    </lemma>
  </subsection>
  <subsection>
    <title>The final group-theoretic ingredient</title>
    <p>
      With this, <xref ref="T_principal_ideal_theorem"/> follows from the following fact.
    </p>
    <theorem xml:id="T_transfer_vanishes">
      <statement>
        <p>
          Let <m>G</m> be a finite group and <m>H</m> its commutator subgroup.
          Then the transfer map <m>V: G^{\ab} \to H^{\ab}</m> is zero.
        </p>
      </statement>
      <proof>
        <p>
          See <xref ref="exc-transfer-vanishes"/>.
        </p>
      </proof>
    </theorem>
    <remark>
       <p>
       The fact that <xref ref="T_transfer_vanishes"/> is so general means that we can easily obtain some extensions of <xref ref="T_principal_ideal_theorem"/>.
       For example, it was observed by Iyanaga that if <m>L</m> is the ray class field of <m>K</m> of some modulus <m>\gothm</m>, and <m>\gothm \gotho_L</m>
       is the extension of this modulus to <m>L</m> (that is, extend the finite part and take all places of <m>L</m> above the infinite places in <m>\gothm</m>),
       then the induced map <m>\Cl^{\gothm}(K) \to \Cl^{\gothm}(L)</m> again vanishes.
       </p>
    </remark>
  </subsection>
  <subsection>
    <title>Additional remarks</title>
    <remark xml:id="R-class-field-towers">
      <p>
        One important qualification of <xref ref="T_principal_ideal_theorem"/> is that <m>L</m> need not itself have class number 1.
        In fact, it is an open problem to show that every number field <m>K</m> admits an extension which has class number 1.
      </p>
      <p>
        One approach to constructing such an extension would be to consider the <term>class field tower</term> over <m>K</m>,
        in which <m>K_0 = K</m> and for each positive integer <m>i</m>, <m>K_i</m> is the Hilbert class field of <m>K_{i-1}</m>.
        However, Golod and Shafarevich showed that in certain cases this sequence grows without bound; for example,
        this holds if <m>K</m> is an imaginary quadratic field in which at least six distinct primes of <m>\QQ</m> ramify.
        In particular, in such cases <m>K</m> admits an <em>infinite</em> unramified extension.
        (See <xref ref="bib-Cassels-Frohlich"/> for more discussion.)
      </p>
    </remark>
    <remark xml:id="rmk-Polya-field">
      <p>
        Let <m>K</m> be a number field. Let <m>M</m> be the <m>\gotho_K</m>-submodule of <m>K[x]</m> consisting of <term>integer-valued</term> polynomials,
        meaning those that map <m>\gotho_K</m> into itself. The field <m>K</m> is said to be a <term>P&#xf3;lya field</term> if <m>M</m> admits a basis
        consisting of polynomials of pairwise distinct degrees; such a basis is called a <term>regular basis</term>. Any field with trivial class group is a 
        P&#xf3;lya field, but not conversely. The terminology is due to Zantema <xref ref="bib-Zantema"/>, who showed among other things that every
        cyclotomic field is a P&#xf3;lya field.
      </p>
      <p>
        Using <xref ref="T_principal_ideal_theorem"/>, Leriche showed that the Hilbert class field of any number field is a P&#xf3;lya field (see <xref ref="bib-Leriche"/>, Corollary 3.2).
        In particular, every number field can be embedded into a P&#xf3;lya field via an abelian extension, whereas it is unknown whether every number field can be embedded into a field
        of class number one (and <xref ref="R-class-field-towers"/> shows that solvable extensions are definitely not enough).
      </p>
    </remark>
  </subsection>
  <exercises>
    <title>Exercises</title>
      <exercise xml:id="exc-transfer-homomorphism">
        <statement>
          Prove <xref ref="T_transfer_homomorphism"/>.
        </statement>
        <hint>
          One approach to proving independence from choices is to change one <m>g_i</m> at a time.
          Also, notice that <m>\phi(gg_1), \dots, \phi(gg_n)</m> are a permutation of <m>g_1, \dots, g_n</m>.
        </hint>
      </exercise>
      <exercise xml:id="exc-transfer-Frobenius">
        <statement>
          Prove <xref ref="L_transfer_Frobenius"/>.
        </statement>
        <hint>
          See <xref ref="bib-Neukirch"/>, Proposition IV.5.9.
        </hint>
      </exercise>
      <exercise xml:id="exc-augmentation">
        <statement>
          Let <m>H \subseteq G</m> be an inclusion of finite groups.
          Let <m>G'</m> and <m>H'</m> be the commutator subgroups of <m>G</m> and <m>H</m>.
          Let <m>\ZZ[G]</m> be the group algebra of <m>G</m>, i.e., the (noncommutative) ring of formal linear combinations
          <m>\sum_{g \in G} n_g [g]</m> with <m>n_g \in \ZZ</m>,
          multiplied by putting <m>[g][h] = [gh]</m>.
          Let <m>I_G \subset \ZZ[G]</m> be the ideal of sums <m>\sum n_g[g]</m> with <m>\sum n_g = 0</m>
          (called the <term>augmentation ideal</term>; see <xref ref="sec_homology"/>).
          Let
          <me>
            \delta: H/H' \to (I_{H}+I_GI_{H})/I_GI_{H}
          </me>
          be the homomorphism taking the class of <m>h</m> to the class of <m>[h]-1</m>.
          Prove that <m>\delta</m> is an isomorphism.
        </statement>
        <hint>
          Show that the elements
          <me>
            [g]([h]-1) \qquad \mbox{for \(g \in \{g_1,\dots,g_n\}, h \in H\)}
          </me>
          form a basis of <m>I_H + I_G I_H</m> as a <m>\ZZ</m>-module.
          For more clues, see <xref ref="bib-Neukirch"/>, Lemma VI.7.7.
        </hint>
      </exercise>
      <exercise>
        <statement>
          <p>
          With notation as in <xref ref="exc-augmentation"/>,
          prove that the diagram in <xref ref="fig-principal-3"/> commutes, 
          where <m>S</m> is given by <m>S(x) = x ([g_1] + \cdots + [g_n])</m>.
          </p>
          <figure xml:id="fig-principal-3">
          <image xml:id="img-principal-3">
          <latex-image>
          \xymatrix{
          G/G' \ar^{V}[r] \ar^{\delta}[d] &amp; H/H' \ar^{\delta}[d] \\
          I_G/I_G^2 \ar^(.3){S}[r] &amp; (I_{H}+I_GI_{H})/I_GI_{H},
          }
          </latex-image>
          </image>
          </figure>
        </statement>
      </exercise>
      <exercise xml:id="exc-transfer-vanishes">
        <statement>
          Prove <xref ref="T_transfer_vanishes"/>.
        </statement>
        <hint>
          Quotient by the commutator subgroup of <m>H</m> to reduce to the case where <m>H</m> is abelian.
          Apply the classification of finite abelian groups to write <m>G/H</m> as a product of cyclic groups <m>\ZZ/e_1 \ZZ \times \cdots \times \ZZ/e_m \ZZ</m>.
          Let <m>f_i</m> be an element of <m>G</m> lifting a generator of
          <m>\ZZ/e_i \ZZ</m> and put <m>h_i = f_i^{-e_i} \in H</m>;
          then <m>0 = \delta(f_i^{e_i} h_i)</m>,
          which can be rewritten as <m>\delta(f_i) \mu_i</m> for some
          <m>\mu_i \in \ZZ[G]</m> congruent to <m>e_i</m> modulo <m>I_G</m>.
          Now check that
          <me>
            n \mu_1 \cdots \mu_m \equiv [g_1] + \cdots + [g_n] \pmod{I_H \ZZ[G]}
          </me>.
          For more details, see <xref ref="bib-Neukirch"/>, Theorem VI.7.6.
        </hint>
      </exercise>
  </exercises>
</section>
