<section xml:id="sec_abstractcft">
  <title>Abstract class field theory</title>
  <introduction>
    <paragraphs>
      <title>Reference</title>
      <p>
        <xref ref="bib-Neukirch"/>, IV.4-IV.6.
        Remember that Neukirch's cohomology groups are all Tate groups,
        so he doesn't put the subscript <q>T</q> on them.
      </p>
    </paragraphs>
    <p>
      We now turn to an alternate method for deriving the main result of local class field theory,
      the local reciprocity law.
      This method, based on a presentation of Artin and Tate,
      isolates the main cohomological inputs in the local case
      and gives an outline of how to proceed to global class field theory.
      (Warning: this method does not give information about the local invariant map.)
    </p>
    <paragraphs>
    <title>Caveat</title>
    <p>
      Certain words you thought you knew what they meant, such as
      <q>unramified</q>, are going to be reassigned more abstract meanings.
      But these meanings will coincide with the correct definitions over a local field.
    </p>
    </paragraphs>
  </introduction>
  <subsection>
    <title>Abstract unit groups and the class field axiom</title>
    <p>
    We first introduce an abstract analogue of the groups <m>K^*</m>, for <m>K</m> a finite extension of <m>k</m>,
    and the norm maps between them. This enables us to state a key cohomological assumption.
    </p>
    <definition xml:id="def-abstract-units">
      <p>
      Let <m>k</m> be a field, let <m>\kbar</m> be an algebraic extension of <m>k</m>, and put <m>G = \Gal(\kbar/k)</m>.
      Let <m>A</m> be a <m>G</m>-module.
      In the example where <m>k</m> is a local field, we will take <m>\kbar</m> to be the separable closure and <m>A = \kbar^*</m>.
      </p>
    </definition>
    <remark>
      <p>
        In this discussion, we are not going to make any explicit use of the field <m>k</m>; we are really just working with the profinite group <m>G</m>.
        One could extend this discussion to a general profinite group <m>G</m>, as is done in <xref ref="bib-Neukirch"/>,
        by <q>pretending</q> that the profinite group corresponds to a field and its extensions via the Galois correspondence.
        That is, a <q>field extension</q> of <m>k</m> corresponds to a closed subgroup of <m>G</m>; a <q>finite extension</q> of <m>k</m> corresponds to an
        open subgroup of <m>G</m>; and so on.
      </p>
    </remark>
    <definition>
      <p>
      For any field <m>K</m> between <m>k</m> and <m>\kbar</m>, define <m>A_K = A^{G_K} = A^{\Gal(K/k)}</m>.
      For <m>L/K</m> a finite extension of such fields, define the <term>norm map</term> <m>\Norm_{L/K}: A_L \to A_K</m> by <m>\Norm_{L/K}(a) = \prod_g a^g</m>,
      where <m>g</m> runs over a set of right coset representatives of <m>G_K</m> in <m>G_L</m>.
      </p>
    <p>
      For <m>L/K</m> an infinite extension of fields between <m>k</m> and <m>\kbar</m>, we don't have a well-defined norm map from <m>A_L</m> to <m>A_K</m>.
      By convention, however, we still write <m>\Norm_{L/K} A_L</m> to mean the intersection of
      <m>\Norm_{M/K} A_M</m> over all finite subextensions <m>M/K</m> of <m>L</m>.
    </p>
    </definition>
    <definition>
      <p>
      Set notation as in <xref ref="def-abstract-units"/>.
      We say that <m>A</m> satisfies the <term>class field axiom</term> if for every <em>cyclic</em>
      extension <m>L/K</m> of finite subextensions of <m>\kbar/k</m>,
      <me>
        \#H^i_T(\Gal(L/K), A_L) = \begin{cases} [L:K] \amp  i=0 \\ 1 \amp  i = -1. \end{cases}
      </me>
      Note that in general, it is not enough to impose this condition when <m>K = k</m>.
      </p>
    </definition>
    <p>
      Under the class field axiom and the other conditions of abstract class field theory, for each finite Galois extension <m>L/K</m> of finite separable extensions of <m>k</m>,
      we will define a canonical isomorphism <m>r_{L/K}: \Gal(L/K)^{\ab} \to A_K / \Norm_{L/K} A_L</m>
      (<xref ref="T_abstract_reciprocity_law"/>). 
      Since we've already checked the class field axiom in the example where <m>k</m> is a local field and <m>A = \kbar^*</m>,
      this will recover the local reciprocity law (<xref ref="T_local_reciprocity"/>).
    </p>
    </subsection>
  <subsection>
    <title>Abstract ramification theory</title>
    <p>
      We next encode the key aspects of ramification theory into an abstract framework. At the moment this has nothing to do with the abstract units;
      the relationship will be made when we introduce abstract valuations a bit later.
    </p>
    <definition xml:id="def-abstract-frobenius">
    <p>
      With notation as in <xref ref="def-abstract-units"/>,
      let <m>d: G \to \widehat{\ZZ}</m> be a continuous surjective homomorphism.
      The example we have in mind is when <m>k</m> is a local field and <m>d</m> is the surjection of <m>G</m> onto <m>\Gal(k^{\unr}/k) \cong \widehat{\ZZ}</m>.
    </p>
    <p>
      Define the <term>Weil group</term> of <m>k</m> as the subgroup <m>d^{-1}(\ZZ)</m> of <m>G</m>.
      This group will play an important role in the construction of the reciprocity map,
      via <xref ref="prop_norm"/> below.
    </p>
    </definition>
    <p>
      We now set some more notation to mimic the example case.
    </p>
    <definition>
    <p>
      Define the <term>inertia group</term> <m>I_k</m> to be the kernel of <m>d</m>.
      Define the <term>maximal unramified extension</term> <m>k^{\unr}</m> of <m>k</m> to be the fixed field of <m>I_k</m>.
      Likewise, for any field <m>L</m> between <m>k</m> and <m>\kbar</m>, put <m>G_L = \Gal(\kbar/L)</m> and <m>I_L = G_L \cap I_k</m>, and let
      <m>L^{\unr} = k^{\unr} L</m> be the fixed field of <m>I_L</m>. 
    </p>
    <p>
      We say an extension <m>L/K</m> is <term>unramified</term> if <m>L \subseteq K^{\unr}</m>.
      Note that this implies that <m>G_L</m> contains <m>I_K</m>,
      necessarily as a normal subgroup,
      and <m>G_L/I_K \subseteq G_K/I_K</m> injects via <m>d</m> into <m>\widehat{\ZZ}</m>;
      thus <m>G_L/I_K</m> is abelian and any finite quotient of it is cyclic.
      In particular,
      <m>G_K</m> is Galois in <m>G_L</m> and <m>\Gal(L/K) = G_L/G_K</m> is cyclic.
      (Note also that <m>K^{\unr}</m> is the compositum of <m>K</m> and <m>k^{\unr}</m>.)
    </p>
    </definition>
    <p>
      If <m>K \neq k</m>,
      then <m>d</m> doesn't map <m>G_K</m> onto <m>\widehat{\ZZ}</m>,
      so it will be convenient to renormalize things.
    </p>
    <definition>
    <p>
      Put
      <me>
        d_K = \frac{1}{[\widehat{\ZZ}: d(G_K)]}d: G_K \to \widehat{\ZZ};
      </me>
      then <m>d_K</m> is surjective,
      and induces an isomorphism <m>d_K: \Gal(K^{\unr}/K) \to \widehat{\ZZ}</m>.
    </p>
    <p>
      Given a finite extension <m>L/K</m> of fields between <m>k</m> and <m>\kbar</m>,
      define the <term>inertia degree</term>
      (or <term>residue field degree</term>)
      <m>f_{L/K} = [d(G_K):d(G_L)]</m> and the
      <term>ramification degree</term>
      <m>e_{L/K} = [I_K:I_L]</m>.
      By design we have multiplicativity:
      <m>e_{M/K} = e_{M/L}e_{L/K}</m> and <m>f_{M/K} = f_{M/L}f_{L/K}</m>.
      Moreover, if <m>L/K</m> is Galois, we have an exact sequence
      <me>
        1 \to I_K/I_L \to \Gal(L/K) \to d(G_K)/d(G_L) \to 1
      </me>
      so the
      <q>fundamental identity</q>
      holds:
      <me>
        e_{L/K}f_{L/K} = [L:K]
      </me>.
    </p>
    <p>
      The same is true if <m>L/K</m> is not Galois:
      let <m>M</m> be a Galois extension of <m>K</m> containing <m>L</m>,
      then apply the fundamental identity to <m>M/L</m> and <m>M/K</m> and use multiplicativity.
    </p>
    </definition>
  </subsection>
    <subsection>
    <title>Abstract valuation theory</title>
    <p>
      We next introduce an abstract analogue of the valuation maps on unit groups, which tie <m>d</m> and <m>A</m> together in a crucial way.
      The catch is that these valuations will be valued not in <m>\ZZ</m> but only in <m>\widehat{\ZZ}</m>;
      however, this is okay because we only need them to normalize the definition of the reciprocity map.
    </p>
    <definition xml:id="def-abstract-henselian-valuation">
      <p>
        With notation as in <xref ref="def-abstract-units"/> and <xref ref="def-abstract-frobenius"/>,
        a <term>henselian valuation</term> of <m>A_k</m> with respect to <m>d</m> is a homomorphism <m>v: A_k \to \widehat{\ZZ}</m> such that:
        <ol>
          <li>
            <p>
              the group <m>Z = \im(v)</m> contains <m>\ZZ</m> and satisfies
              <m>Z/nZ \cong \ZZ/n\ZZ</m> for all positive integers <m>n</m>;
            </p>
          </li>
          <li>
            <p>
              for every finite extension <m>K</m> of <m>k</m>, <m>v(\Norm_{K/k} A_K) = f_{K/k} Z</m>.
            </p>
          </li>
        </ol>
      </p>
      <p>
        In this case, for each field <m>K</m> between <m>k</m> and <m>\kbar</m>, we obtain a henselian valuation
        <m>v_K: A_K \to Z</m> by setting
        <me>
          v_K = \frac{1}{f_{K/k}} \circ \Norm_{K/k}.
        </me>
        Then <m>v_{K}(a) = v_{K^g}(a^g)</m> for any <m>a \in A</m> and <m>g \in G</m>,
        and for <m>L/K</m> a finite extension (of fields between <m>k</m> and <m>\kbar</m>),
        <m>v_K(\Norm_{L/K}(a)) = f_{L/K} v_L(a)</m> for any <m>a \in A_L</m>.
      </p>
    </definition>
    <example xml:id="exa-abstract-CFT-local">
      <p>
        By design, the previous conditions are satisfied in the case where:
        <ul>
          <li>
            <p>
              <m>k</m> is a local field of characteristic 0 and <m>\kbar</m> is its algebraic closure;
            </p>
          </li>
          <li>
            <p>
              <m>A = \kbar^*</m> (the class field axiom is confirmed by <xref ref="L_theorem_90"/> for <m>H^1_T</m> and <xref ref="P_local_cyclic_H2"/> for <m>H^0_T</m>);
            </p>
          </li>
          <li>
            <p>
              <m>d: \Gal(\kbar/k) \to \widehat{\ZZ}</m> the map coming from the identification of <m>\Gal(k^{\unr}/k)</m> with <m>\widehat{\ZZ}</m>;
            </p>
          </li>
          <li>
            <p>
              <m>v: A_k \to \widehat{\ZZ}</m> is the composition of the valuation <m>k^* \to \ZZ</m> with the inclusion <m>\ZZ \to \widehat{\ZZ}</m>.
            </p>
          </li>
        </ul>
      </p>
    </example>
    <example>
      <p>
        A basic example of these constructions occurs for <m>k</m> finite; see <xref ref="exer-abstract-cft-finite-field"/>.
        A closely related example can be obtained from <xref ref="exa-abstract-CFT-local"/> by replacing the algebraic closure of <m>k</m> with its maximal unramified subextension.
      </p>
    </example>
    </subsection>
    <subsection>
    <title>Cohomology of units</title>
    <p>
      Before defining the reciprocity map, we collect some direct consequences of the class field axiom.
      These are very similar to arguments we used in the proof of local reciprocity,
      except that we are now running the computation in reverse: instead of using the cohomology of unramified extensions
      to establish the class field axiom, we are going the other way around!
    </p>
    <hypothesis xml:id="hypo-abstract-cft">
      <p>
        For the remainder of this chapter, fix <m>k, A, d, v</m> as in <xref ref="def-abstract-units"/>, <xref ref="def-abstract-frobenius"/>,
        and <xref ref="def-abstract-henselian-valuation"/>. In particular, <m>A</m> satisfies the class field axiom and <m>v</m> is a henselian valuation of <m>A_k</m>
        with respect to <m>d</m>.
      </p>
    </hypothesis>
    <definition>
      <p>
        For any field <m>K</m> between <m>k</m> and <m>\kbar</m>,
        define the <term>unit subgroup</term>
        <m>U_K</m> as the set of <m>u \in A_K</m> with <m>v_k(u) = 0</m>.
        If <m>K/k</m> is finite,
        we say <m>\pi \in A_K</m> is a <term>uniformizer</term>
        for <m>K</m> if <m>v_K(\pi) = 1</m>.
      </p>
    </definition>
    <proposition xml:id="P_abstract_H0H1">
      <statement>
        <p>
          Under <xref ref="hypo-abstract-cft"/>, 
          for <m>L/K</m> an unramified extension of finite subextensions of <m>kbar/k</m>,
          <m>H^i_T(\Gal(L/K), U_L) = 1</m> for <m>i=0, -1</m>.
          Moreover, <m>H^0_T(\Gal(L/K), A_L)</m> is cyclic and is generated by any uniformizer <m>\pi_L</m> for <m>L</m>.
        </p>
      </statement>
    </proposition>
    <proof>
      <p>
        We'll drop <m>\Gal(L/K)</m> from the notation,
        because it's the same group throughout the proof.
        Keep in mind that an unramified extension is always Galois and cyclic,
        so we can apply periodicity of Tate groups (<xref ref="T_cyclic_group_periodicity"/>) and Herbrand quotients.
      </p>
      <p>
        Consider the short exact sequence 
        <me>
          0 \to U_L \to A_L \to A_L/U_L \to 0.
        </me>
        In this sequence, <m>A_L/U_L</m> is isomorphic to
        <m>Z = \im(v)</m> with trivial group action,
        so <m>H^0_T(Z) = Z/\Norm(Z)</m> is cyclic of order <m>[L:K]</m> generated by <m>\pi_L</m> and
        <m>H^{-1}_T(Z) = \ker(\Norm)</m> is trivial. Using the class field axiom, we see that the
        long exact sequence in Tate groups looks like
        <me>
          1 = H^{-1}_T(A_L/U_L) \to H^{0}_T(U_L) \to H^{0}_T(A_L) \to H^{0}_T(A_L/U_L) \to H^{1}_T(U_L) \to H^1_T(A_L) = 1
        </me>
        and the two groups in the middle have the same order.
        It is thus enough to show that one of the outer groups is trivial,
        as then the middle map will be an isomorphism.
      </p>
      <p>
        We have now reduced to checking that <m>H^{1}_T(U_L) = 1</m>.
        Here is where we use that <m>L/K</m> is unramified, not just cyclic: this means that any uniformer of <m>K</m> is also a uniformizer of <m>L</m>,
        which allows us to split the surjection <m>A_L \to A_L/U_L</m> of <m>\Gal(L/K)</m>-modules. This in turn means that <m>H^1_T(U_L)</m> is a direct
        summand of <m>H^1_T(A_L)</m>, and the latter vanishes by the class field axiom.
      </p>
    </proof>
    <corollary xml:id="C_abstract_unramified">
      <statement>
        <p>
          Under <xref ref="hypo-abstract-cft"/>, 
          for <m>L/K</m> an unramified extension of finite subextensions of <m>\kbar/k</m>, then <m>U_K = \Norm_{L/K} U_L</m>. (Remember,
          this makes sense even if <m>L/K</m> is not finite!)
        </p>
      </statement>
      <proof>
        <p>
          Apply the <m>i=0</m> case of <xref ref="P_abstract_H0H1"/> to each finite subextension of <m>L/K</m>.
        </p>
      </proof>
    </corollary>
    <p>
      We can formally promote <xref ref="C_abstract_unramified"/> as follows.
    </p>
    <lemma xml:id="lem-intermediate-norm">
      <statement>
        <p>
          Under <xref ref="hypo-abstract-cft"/>, 
          let <m>M/L/K</m> be finite subextensions of <m>k</m> 
          with <m>M/K</m> Galois and <m>L/K</m> unramified.
          Then <m>U_K \cap \Norm_{M/L} U_M \subseteq \Norm_{M/K} U_M</m>.
          (Note that the case <m>M=L</m> recovers <xref ref="C_abstract_unramified"/>.)
        </p>
      </statement>
    </lemma>
    <proof>
      <p>
        Put <m>G = \Gal(M/K), H = \Gal(M/L)</m>; the claim is that the map
        <m>\Res: H^0_T(G, U_M) \to H^0_T(H, U_M)</m> is injective.
        Since <m>H^0_T(G/H, U_L) = 0</m> by <xref ref="C_abstract_unramified"/>, we may apply 
        <xref ref="lem-inflation-restriction-H0"/> to conclude.
        (If you prefer a less cohomological argument, see instead <xref ref="bib-Neukirch"/>, Lemma<nbsp/>IV.5.4.)
      </p>
    </proof>
    <p>
      The following lemma is a variant of the inflation-restriction exact sequence,
      obtained by dimension shifting. (Beware that inflation maps do not in general exist for <m>H^0_T</m>.)
    </p>
    <lemma xml:id="lem-inflation-restriction-H0">
      <statement>
        <p>
          Let <m>H</m> be a normal subgroup of a finite group <m>G</m> and <m>M</m> a <m>G</m>-module.
          If <m>H^0_T(G/H, M^H) = 0</m>, then <m>\Res: H^0_T(G,M) \stackrel{\Res}{\to} H^0_T(H,M)</m> is injective.
        </p>
      </statement>
    </lemma>
    <proof>
      <p>
        Choose <m>N</m> so that <m>0 \to N \to \Ind^G_{1} M \to M \to 0</m> is exact (where again
        <m>\Ind^G_1 M \to M</m> is the map <m>m \otimes [g] \mapsto m^g</m>);
        then by the usual inflation-restriction exact sequence (<xref ref="P_inflation_restriction"/>),
        <me>
          0 \to H^1_T(G/H, N^H) \stackrel{\Inf}{\to} H^1_T(G,N) \stackrel{\Res}{\to} H^1_T(H,N)
        </me>
        is exact.
        Now <m>\Ind^G_{1} M</m> is acyclic for <m>G</m> and for <m>H</m>,
        and <m>(\Ind^G_1 M)^H</m> is acyclic for <m>G/H</m>.
        Moreover, if we take <m>H</m>-invariants, we have an exact sequence
        <me>
          0 \to N^H \to (\Ind^G_1 M)^H \to M^H \to 0;
        </me>
        namely, exactness on the right holds because any
        <m>m \in M^H</m> lifts to <m>m \otimes [1] \in (\Ind^G_1 M)^H</m>.
        Using long exact sequences,
        we now see first that <m>H^1_T(G/H, N^H) = H^0_T(G/H, M^H) = 0</m>,
        then deduce that <m>\Res: H^1_T(G,N) \to H^1_T(H,N)</m> is injective,
        then finally deduce the desired result.
      </p>
    </proof>
  </subsection>
  <subsection xml:id="subsec-abstract-recip-definition">
  <title>Construction of the reciprocity map</title>
    <p>
      Our next goal is to define a candidate <m>r: \Gal(L/K) \to A_K/\Norm_{L/K} A_L</m> for the reciprocity map;
      as a bonus, this definition will give an explicit recipe for computing the reciprocity map in 
      local class field theory.
    </p>
    <definition xml:id="def-abstract-recip-candidate">
      <p>
        Under <xref ref="hypo-abstract-cft"/>, let <m>L/K</m> be a Galois extension of finite subextensions of <m>\kbar/k</m>.
        Let <m>H</m> be the semigroup of
        <m>g \in \Gal(L^{\unr}/K)</m> such that <m>d_K(g)</m> is a positive integer.
        Define the map 
        <me>r': H \to A_K/\Norm_{L/K} A_{L}</me> 
        as follows.
        For <m>g \in \Gal(L^{\unr}/K)</m>,
        let <m>M</m> be the fixed field of <m>g</m> (so that
        <m>e(M/K) = e((M \cap L)/K)</m> and <m>f(M/K) = d_K(g)</m>),
        and set <m>r'(g) = \Norm_{M/K} (\pi_M)</m> for some uniformizer <m>\pi_M</m>.
        This doesn't depend on the choice of uniformizer:
        if <m>\pi'_M</m> is another one,
        then <m>\pi_M/\pi'_M \in U_L</m> belongs to
        <m>\Norm_{L^{\unr}/L} U_{L^{\unr}}</m> by <xref ref="C_abstract_unramified"/>,
        so <m>\Norm_{M/K} (\pi_M/\pi'_M)</m> belongs to <m>\Norm_{L^{\unr}/K} U_{L^{\unr}} \subseteq \Norm_{L/K} U_L</m>.
        So at least <m>r'</m> is now a well-defined map,
        if not yet a semigroup homomorphism.
      </p>
    </definition>
    <remark xml:id="rmk-abstract-recip-properties">
      <p>
        Before getting into the weeds,
        let's make some other observations about <xref ref="def-abstract-recip-candidate"/>.
      </p>
      <p>
        First, <m>r'</m> is invariant under conjugation:
        if we replace <m>g</m> by <m>h^{-1}gh</m>,
        then its fixed field <m>M</m> is replaced by <m>M^h</m> and we can take the uniformizer <m>\pi_M^h</m>.
      </p>
      <p>
        Next, if <m>g \in H</m> is actually in <m>\Gal(L^{\unr}/L)</m>,
        then <m>r'(g) \in \Norm_{L/K} A_L</m>.
        In that case, <m>M</m> contains <m>L</m>,
        so <m>r'(g) = \Norm_{M/K}(\pi_M)</m> can be rewritten as
        <m>\Norm_{L/K} \Norm_{M/L} (\pi_M)</m>, so is manifestly a norm.
        That is, if <m>r'</m> were known to be multiplicative,
        it would induce a group homomorphism from
        <m>\Gal(L/K)</m> to <m>A_K/\Norm_{L/K} A_L</m>.
      </p>
    </remark>
    <p>
      The remaining difficulty is to check that <m>r'</m> is multiplicative. 
      The issue here is that the definition of <m>r'(g)</m> involves taking the norm from a field extension that
      depends on <m>g</m>, so it is hopeless to use the formula directly to compare different values of <m>g</m>.
      Instead, we rewrite the definition in a more uniform manner.
    </p>
    <proposition xml:id="prop_norm">
      <statement>
        <p>
          Under <xref ref="hypo-abstract-cft"/>, 
          let <m>L/K</m> be an extension of finite subextensions of <m>k</m>.
          Choose <m>h, \phi \in \Gal(L^{\unr}/K)</m> such that <m>d_K(\phi) = 1</m>
          and <m>d_K(h)</m> is a positive integer <m>n</m>.
          Let <m>M</m> be the fixed field of <m>h</m>.
          Then for <m>x \in A_M</m>,
          <me>
            \Norm_{M/K}(x) = \Norm_{L^{\unr}/K^{\unr}}(x x^\phi \cdots x^{\phi^{n-1}}).
          </me>
        </p>
      </statement>
      <proof>
        <p>
          Put <m>U = M \cap K^{\unr}</m>, so that <m>\Norm_{M/K} = \Norm_{U/K} \circ \Norm_{M/U}</m>.
          The group <m>\Gal(U/K)</m> is of order <m>n</m> generated by <m>\phi</m>, so for <m>y \in A_U</m>
          we have <m>\Norm_{U/K}(y) = y y^\phi \cdots y^{\phi^{n-1}}.</m>
          Meanwhile, on <m>A_M</m> we can view <m>\Norm_{M/U}</m> as the restriction of <m>\Norm_{L^{\unr}/K^{\unr}}</m>,
          so <m>\Norm_{M/U}(x) = \Norm_{L^{\unr}/K^{\unr}}(x)</m>. By taking <m>y = \Norm_{M/U}(x)</m> and rewriting
          <m>y^{\phi^i}</m> as <m>\Norm_{L^{\unr}/K^{\unr}}(x)^{\phi^i} = \Norm_{L^{\unr}/K^{\unr}}(x^{\phi^i})</m>,
          we deduce the claim.
        </p>
      </proof>
    </proposition>
    <p>
      Using the formula from <xref ref="prop_norm"/>, we can now establish multiplicativity.
    </p>
    <lemma xml:id="lem-abstract-recip-multiplicative">
      <statement>
        <p>
          The map <m>r': H \to A_K/\Norm_{L/K} A_L</m> exhibited in <xref ref="def-abstract-recip-candidate"/> is a homomorphism of semigroups.
        </p>
      </statement>
      <proof>
        <p>
          Let <m>g_1, g_2 \in H</m> be arbitrary and put <m>g_3 = g_1g_2</m>.
          Let <m>M_i</m> be the fixed field of <m>g_i</m>,
          let <m>\pi_i</m> be a uniformizer of <m>M_i</m>,
          and put <m>\rho_i = r(g_i) = \Norm_{M_i/K}(\pi_i)</m>.
          Our goal is to check that
          <me>
            \rho_1\rho_2/\rho_3 \in \Norm_{L/K} A_{L}.
          </me>
          To begin with, note that
          <me>
            v_K(\rho_i) = f(M_i/K) v_{M_i}(\pi_i) = f(M_i/K) = d_K(g_i),
          </me>
          which implies that <m>v_K(\rho_1 \rho_2 /\rho_3) = 0</m>.
        </p>
        <p>
          Choose <m>\phi \in H</m> such that <m>d_K(\phi) = 1</m>.
          Put <m>d_i = d_K(g_i)</m> and 
          <me>
            \sigma_i = \pi_i \pi_i^\phi \cdots \pi_i^{\phi^{d_i-1}} \in M_i;
          </me>
          by <xref ref="prop_norm"/>, we have <m>\rho_i = \Norm_{L^{\unr}/K^{\unr}}(\sigma_i)</m>.
        </p>
        <p>
          Now put <m>u = \sigma_1 \sigma_2/\sigma_3</m>;
          then <m>u \in U_{L^{\unr}}</m> and we need to show that
          <m>\Norm_{L^{\unr}/K^{\unr}}(u) = \rho_1 \rho_2/\rho_3</m> belongs to <m>\Norm_{L/K} A_L</m>.
          Let <m>N</m> be a finite unramified extension of <m>L</m> such that <m>u \in U_N</m>,
          so that <m>\Norm_{L^{\unr}/K^{\unr}}(u) = \Norm_{N/N \cap K^{\unr}}(u)</m>.
          Since this quantity belongs to <m>K</m> (from its expression as <m>\rho_1 \rho_2/\rho_3</m>),
          we may apply <xref ref="lem-intermediate-norm"/> to deduce that
          <me>
            \Norm_{L^{\unr}/K^{\unr}}(u) \in \Norm_{N/K} U_N \subset \Norm_{L/K} A_L
          </me>
          as required.
        </p>
      </proof>
    </lemma>
    <definition xml:id="def-abstract-recip-final">
      <p>
        With notation as in <xref ref="def-abstract-recip-candidate"/>,
        by combining <xref ref="def-abstract-recip-candidate"/>, <xref ref="rmk-abstract-recip-properties"/>, and
        <xref ref="lem-abstract-recip-multiplicative"/>, we obtain a semigroup homomorphism
        <m>r': H \to A_K/\Norm_{L/K}A_L</m> which kills <m>\Gal(L^{\unr}/L)</m>
        and thus induces a homomorphism <m>r = r_{L/K}: \Gal(L/K) \to A_K/\Norm_{L/K}A_L</m>.
        We call <m>r_{L/K}</m> the <term>reciprocity map</term>.
      </p>
    </definition>
    <p>
      Here are a few consequences of the construction whose proofs are left to the reader.
   </p>
    <proposition xml:id="P_abstract_functorialities">
      <statement>
        <p>
          Under <xref ref="hypo-abstract-cft"/>, 
          if <m>L/K</m> and <m>L'/K'</m> are Galois extensions of finite subextensions of <m>\kbar/k</m> such that
          <m>K \subseteq K'</m> and <m>L \subseteq L'</m>,
          then the natural map <m>\Gal(L'/K')^{\ab} \to \Gal(L/K)^{\ab}</m> is compatible via the reciprocity map with <m>\Norm_{K'/K}: A_{K'} \to A_K</m>.
          If moreover <m>K' \subseteq L</m>,
          then the natural map <m>A_K \to A_{K'}</m> is compatible with the transfer map <m>\Ver: \Gal(L/K)^{\ab} \to \Gal(L'/K')^{\ab}</m>.
        </p>
      </statement>
      <proof>
        <p>
          See <xref ref="exer-abstract-functorialities"/>.
        </p>
      </proof>
    </proposition>
  </subsection>
  <subsection>
    <title>Proof of the reciprocity law</title>
    <p>
      Our goal is to prove that the homomorphism <m>r_{L/K}</m> from <xref ref="def-abstract-recip-final"/> induces an isomorphism
      <m>\Gal(L/K)^{\ab} \to A_K / \Norm_{L/K} A_L</m>. Any resemblance with the proof of the local reciprocity law
      is not at all coincidental!
    </p>
    <lemma xml:id="lem-abstract-recip-case1">
      <statement>
        <p>
          Under <xref ref="hypo-abstract-cft"/>, 
          for <m>L/K</m> an unramified extension of finite subextensions of <m>\kbar/k</m>,
          <m>r_{L/K}: \Gal(L/K)^{\ab} \to A_K / \Norm_{L/K} A_L</m> is an isomorphism
          sending the Frobenius of <m>\Gal(L/K)</m> to a uniformizer of <m>K</m>.
        </p>
      </statement>
    </lemma>
    <proof>
      <p>
        The groups <m>\Gal(L/K)</m> and
        <m>A_K/\Norm_{L/K}(A_L) = H^0_T(\Gal(L/K), A_L)</m> are both cyclic of the same order <m>[L:K]</m>,
        the latter by the class field axiom.
        If <m>g \in \Gal(L/K)</m> is the Frobenius,
        and <m>h \in \Gal(L^{\unr}/K)</m> lifts <m>h</m>,
        then the fixed field of <m>h</m> is just <m>K</m> itself,
        and from the definition of <m>r'</m>,
        <m>r(g) = r'(h)</m> is just a uniformizer of <m>K</m>.
        Since that uniformizer generates <m>H^0(\Gal(L/K), A_L)</m>,
        we conclude that <m>r_{L/K}</m> is an isomorphism.
      </p>
    </proof>
    <lemma xml:id="lem-abstract-recip-case2">
      <statement>
        <p>
          Under <xref ref="hypo-abstract-cft"/>,
          for <m>L/K</m> a cyclic, totally ramified extension of finite subextensions of <m>\kbar/k</m>,
          the map <m>r_{L/K}: \Gal(L/K) \to A_K / \Norm_{L/K} A_L</m> is an isomorphism.
        </p>
      </statement>
    </lemma>
    <proof>
      <p>
        Since <m>r_{L/K}</m> maps between two groups of the same order by the <m>H^0_T</m> clause of the class field axiom,
        it suffices to show that it is injective.
      </p>
      <p>
        The extension <m>L^{\unr}/K</m> is the compositum of two linearly disjoint extensions <m>L/K</m> and <m>K^{\unr}/K</m>,
        so its Galois group is canonically a product <m>\Gal(L/K) \times \Gal(K^{\unr}/K)</m>.
        Let <m>g</m> be a generator of the first factor and <m>\phi</m> a generator of the second factor.
        Put <m>\tau = g\phi</m>, so that <m>d_K(\tau)=1</m>,
        and let <m>M</m> be the fixed field of <m>\tau</m>.
        Pick uniformizers <m>\pi_L</m> and <m>\pi_M</m> of <m>L</m> and <m>M</m>, respectively,
        so that <m>r(g) = r'(\tau) = \Norm_{M/K}(\pi_M)</m>.
        Let <m>N</m> be the compositum of <m>L</m> and <m>M</m>.
      </p>
      <p>
        Put <m>n = [L:K]</m>, and suppose
        <m>r(g^j) = \Norm_{M/K}(\pi_M^j)</m> is the identity in <m>A_K/\Norm_{L/K} A_L</m>.
        Since <m>d_K(\tau) = 1</m>,
        we have <m>r(g) = \Norm_{L^{\unr}/K^{\unr}}(\pi_M)</m>.
        On the other hand
        <m>\Norm_{L^{\unr}/K^{\unr}}(\pi_L)</m> is the identity in <m>A_K/\Norm_{L/K} A_L</m>
        (this is effectively the case <m>n=0</m> of <xref ref="prop_norm"/>).
        Thus we also have <m>r(g) = \Norm_{L^{\unr}/K^{\unr}}(\pi_M/\pi_L)</m>.
      </p>
      <p>
        Put <m>u = \pi_L^j/\pi_M^j \in U_N</m>.
        If <m>r(g^j)</m> is in <m>\Norm_{L/K} A_L</m>,
        then there exists <m>v \in U_L</m> such that <m>\Norm_{L^{\unr}/K^{\unr}}(v) = \Norm_{L^{\unr}/K^{\unr}}(u)</m>.
        By the <m>H^{-1}_T</m> clause of the class field axiom,
        we can write <m>u/v</m> as <m>a^g/a</m> for some <m>a \in A_N</m>.
        Now
        <me>
          (\pi_L^j/v)^{g-1} = (\pi_L^j/v)^{\tau-1} = (\pi_M^j u/v)^{\tau - 1} = (u/v)^{\tau-1} = (a^\tau/a)^{g-1}
        </me>.
      </p>
      <p>
        If we put <m>x = (\pi_L^j/v)(a/a^\tau)</m>,
        that means <m>x</m> is <m>g</m>-invariant,
        so it belongs to <m>A_{N_0}</m>,
        where <m>N_0 = N \cap K^{\unr}</m>.
        On one hand, that means <m>v_{N_0}(x) \in \widehat{\ZZ}</m>.
        On the other hand, we have <m>nv_{N_0}(x) = v_N(x) = j</m>.
        Thus <m>j</m> is a multiple of <m>n</m>,
        and <m>r</m> must be injective.
      </p>
    </proof>
    <p>
      Before continuing, we record a key commutative diagram which will be the scene of a lot of diagram-chasing.
    </p>
    <remark>
      <p>
        For <m>L/K</m> a Galois extension of finite subextensions of <m>\kbar/k</m> and <m>M/K</m> a Galois subextension,
        the following diagram:
      </p>
      <figure xml:id="fig-abstractcft-1">
      <image>
      <latex-image>
      \xymatrix{
      1 \ar[r] &amp; \Gal(L/M) \ar[r] \ar^{r_{L/M}}[d] &amp; \Gal(L/K) \ar[r] \ar^{r_{L/K}}[d] &amp; \Gal(M/K) \ar[r] \ar[d]^{r_{M/K}} &amp; 1 \\
      &amp; A_M/\Norm_{L/M}A_L \ar^{\Norm_{M/K}}[r] &amp; A_K/\Norm_{L/K} A_L \ar[r] &amp; A_K / \Norm_{M/K} A_M \ar[r] &amp; 1
      }
      </latex-image>
      </image>
      </figure>
      <p>
        commutes (thanks to <xref ref="P_abstract_functorialities"/>) and the rows are exact.
      </p>
    </remark>
    <lemma xml:id="lem-abstract-recip-case3">
      <statement>
        <p>
          Under <xref ref="hypo-abstract-cft"/>, 
          for <m>L/K</m> an abelian extension of finite subextensions of <m>\kbar/k</m>,
          the map <m>r_{L/K}: \Gal(L/K) \to A_K / \Norm_{L/K} A_L</m> is an isomorphism.
        </p>
      </statement>
      <proof>
        <p>
          We induct on <m>[L:K]</m>.
          If <m>L/K</m> is cyclic of prime order,
          then either it is unramified or totally ramified,
          and we already know <m>r_{L/K}</m> is an isomorphism in those cases
          (by <xref ref="lem-abstract-recip-case1"/> or <xref ref="lem-abstract-recip-case2"/>, respectively).
          Otherwise, let <m>M</m> be a subextension of <m>L/K</m>.
          Then diagram chasing through <xref ref="fig-abstractcft-1"/> gives that <m>r_{L/K}</m> is surjective.
          The same diagram shows further that the kernel of <m>r_{L/K}</m> lies in the kernel of <m>\Gal(L/K) \to \Gal(N/K)</m> for <em>every</em>
          proper subextension <m>N</m> of <m>L/K</m>.
          Since <m>L/K</m> is abelian, the intersection of these kernels is trivial.
          Thus <m>r_{L/K}</m> is also injective, so is an isomorphism.
        </p>
      </proof>
    </lemma>
    <lemma xml:id="lem-abstract-recip-case4">
      <statement>
        <p>
          Under <xref ref="hypo-abstract-cft"/>, 
          for <m>L/K</m> a Galois extension of finite subextensions of <m>\kbar/k</m>,
          the homomorphism <m>r_{L/K}</m> from <xref ref="def-abstract-recip-final"/> induces an injection
          <m>\Gal(L/K)^{\ab} \to A_K / \Norm_{L/K} A_L</m>.
        </p>
      </statement>
      <proof>
        <p>
          Let <m>M</m> be the maximal abelian subextension of <m>L/K</m>. We have the following commutative diagram:
          <figure xml:id="fig-abstractcft-2">
          <image>
          <latex-image>
          \xymatrix{
          \Gal(L/K)^{\ab} \ar^{r_{L/K}}[r] \ar[d] &amp; A_K / \Norm_{L/K} A_L \ar[d] \\
          \Gal(M/K) \ar^{r_{M/K}}[r] &amp; A_K / \Norm_{M/K} A_M
          }
          </latex-image>
          </image>
          </figure>
          in which the left vertical arrow and bottom horizontal arrows are isomorphisms
          (the latter by <xref ref="lem-abstract-recip-case3"/>).
          Thus the composite <m>\Gal(L/K)^{\ab} \to A_K / \Norm_{M/K} A_M</m> is an isomorphism,
          so <m>r_{L/K}</m> must be injective.
        </p>
      </proof>
    </lemma>
    <theorem xml:id="T_abstract_reciprocity_law">
      <title>Reciprocity law</title>
      <statement>
        <p>
          Under <xref ref="hypo-abstract-cft"/>, 
          for each Galois extension <m>L/K</m> of finite subextensions of <m>\kbar/k</m>,
          the homomorphism <m>r_{L/K}</m> from <xref ref="def-abstract-recip-final"/> induces an isomorphism
          <m>\Gal(L/K)^{\ab} \to A_K / \Norm_{L/K} A_L</m>.
        </p>
      </statement>
    </theorem>
    <proof>
      <p>
        The map in question is injective by <xref ref="lem-abstract-recip-case4"/>, so it only remains to check that
        <m>r_{L/K}</m> itself is surjective.
        If <m>L/K</m> is solvable, we may deduce surjectivity from <xref ref="lem-abstract-recip-case3"/> by induction on
        <m>[L:K]</m> again by a diagram chase on <xref ref="fig-abstractcft-1"/>.
      </p>
      <p>
        For general <m>L/K</m>, we instead check that <m>r_{L/K}</m> becomes a surjection upon restriction to <m>p</m>-Sylow
        subgroups for each prime <m>p</m>. That is, for <m>M</m> the fixed field of a Sylow <m>p</m>-subgroup of 
        <m>\Gal(L/K)</m> and <m>S_p</m> the Sylow <m>p</m>-subgroup of <m>A_K/\Norm_{L/K}A_L</m>, the composition
        <me>
          \Gal(L/M) \to \Gal(L/K) \stackrel{r_{L/K}}{\to} A_K/\Norm_{L/K} A_L \to S_p
        </me>
        is surjective. (Compare the proof of <xref ref="L_tate_thm_lemma"/>.)
      </p>
      <p>
        Here some caution is required because <m>M/K</m> need not be Galois, 
        so we cannot draw the full diagram <xref ref="fig-abstractcft-1"/>.
        However, the left square in that diagram still makes sense and commutes.
        Meanwhile, we may apply the previous paragraph to see that the left vertical arrow <m>r_{L/M}</m>
        is an isomorphism. Now note that the inclusion <m>A_K \subseteq A_M</m> induces a 
        homomorphism <m>i: A_K/\Norm_{L/K}A_L \to A_M /\Norm_{L/M} A_L</m> such that
        <m>\Norm_{M/K} \circ i</m> is multiplication by <m>[M:K]</m>,
        which is not divisible by <m>p</m>. It follows that the image of <m>\Norm_{M/K}</m> contains <m>S_p</m>, 
        as then does the image of <m>r_{L/K}</m>.
      </p>
    </proof>
    <p>
      As a bonus byproduct of the proof, we get a version of the norm limitation theorem.
    </p>
    <corollary xml:id="C_abstract_norm_limitation">
      <title>Norm limitation theorem</title>
      <statement>
        <p>
          Under <xref ref="hypo-abstract-cft"/>, 
          for <m>L/K</m> an arbitrary extension of finite separable extensions of <m>k</m>
          and <m>M</m> the maximal abelian subextension of <m>L/K</m>, we have <m>\Norm_{L/K} A_L = \Norm_{M/K} A_M</m>.
        </p>
      </statement>
      <proof>
        <p>
          The only issue is the inclusion <m>\Norm_{M/K} A_M \subseteq \Norm_{L/K} A_L</m>, which we are free to check after enlarging <m>L</m>.
          We may thus assume that <m>L/K</m> is Galois.
        </p>
        <p>
          By <xref ref="P_abstract_functorialities"/> and <xref ref="T_abstract_reciprocity_law"/>, we have a commutative diagram
          <figure xml:id="fig-abstractcft-3">
          <image>
          <latex-image>
          \xymatrix{
          \Gal(L/K)^{\ab} \ar[r] \ar@{=}[d] &amp; A_K/\Norm_{L/K} A_L \ar[d] \\
          \Gal(M/K)^{\ab} \ar[r] &amp; A_K/\Norm_{M/K} A_M
          }
          </latex-image>
          </image>
          </figure>
          in which the horizontal arrows are isomorphisms. This implies the claim.
        </p>
      </proof>
    </corollary>
  </subsection>
  <subsection>
    <title>A look ahead</title>
    <p>
      What does the construction of an abstract reciprocity law tell us about the global Artin reciprocity law
      (<xref ref="T-Artin-reciprocity"/>)?
    </p>
    <p>
      For <m>L/K</m> a finite abelian extension of number fields,
      we need to compare <m>\Gal(L/K)</m> to a generalized ideal class group of <m>K</m>.
      This means that the group <m>A</m> must somehow be related to ideal classes.
      You might try taking the group of fractional ideals in <m>L</m>,
      then taking the direct limit over all finite extensions <m>L</m> of <m>K</m>.
      In this case, we would have to find
      <m>H^i(\Gal(L/K), A_L)</m> for <m>A_L</m> the group of fractional ideals in <m>L</m>,
      where <m>L/K</m> is cyclic and <m>i=0, -1</m>.
      Unfortunately, these groups are not so well-behaved as that!
    </p>
    <p>
      The cohomology groups would behave better if <m>A_L</m> were
      <q>complete</q> in some sense,
      in the way that <m>K^*</m> is complete when <m>K</m> is a local field.
      But there is no good reason to distinguish one place over another in the global case.
      So we're going to make the target group <m>A</m> by
      <q>completing <m>K^*</m> at all places simultaneously</q>.
    </p>
    <p>
      Even without <m>A</m>, I can at least tell you what <m>d</m> is going to be over <m>\QQ</m>.
      To begin with, note that there is a surjective map
      <m>\Gal(\overline{\QQ}/\QQ) \to \Gal(\QQ^{\cyc}/\QQ)</m> that turns an automorphism into its action on roots of unity.
      The latter group is unfortunately isomorphic to the multiplicative group
      <m>\widehat{\ZZ}^*</m> rather than the additive group
      <m>\widehat{\ZZ}</m>, but this is a start.
      To make more progress, write
      <m>\widehat{\ZZ}</m> as the product <m>\prod_p \ZZ_p</m>,
      so that <m>\widehat{\ZZ}^* \cong \prod_p \ZZ_p^*</m>.
      Then recall that there exist isomorphisms
      <me>
        \ZZ_p^* \cong \begin{cases}\ZZ/(p-1)\ZZ \times \ZZ_p \amp  p > 2 \\ \ZZ/2\ZZ \times \ZZ_p \amp  p = 2. \end{cases}
      </me>
    </p>
    <p>
      In particular,
      <m>\ZZ_p^*</m> modulo its torsion subgroup is isomorphic to <m>\ZZ_p</m>,
      but not in a canonical way.
      But never mind about this;
      let us choose an isomorphism for each <m>p</m> and then obtain a surjective map <m>\widehat{\ZZ}^* \to \widehat{\ZZ}</m>.
      Composing, we get a surjective map
      <m>\Gal(\overline{\QQ}/\QQ) \to \widehat{\ZZ}</m> which in principle depends on some choices,
      but the ultimate statements of the theory will be independent of these choices.
      (Note that in this setup, every
      <q>unramified</q>
      extensions of a number field is a subfield of a cyclotomic extension,
      but not conversely.)
    </p>
    <remark>
      <p>
        In the function field setting, we have a much more straightforward alternative to the use of cyclotomic extensions:
        we may take the map to the Galois group of the base finite field. The point is that in this case we have an ample supply
        of <em>everywhere unramified</em> extensions of the base field.
      </p>
      <p>
        In the number field setting, using cyclotomic extensions as a proxy for abelian, everywhere unramified extensions 
        is a rather productive idea even outside of class field theory. For one, it is the central premise of
        <term>Iwasawa theory</term>, in which one studies the behavior of class fields in certain towers of number fields
        and their relationship with <m>p</m>-adic <m>L</m>-functions (and other related concepts).
        For another, it is the starting point of <em><m>p</m>-adic Hodge theory</em>, in which one studies the relationship
        between different cohomology theories associated to algebraic varieties over local fields.
      </p>
    </remark>
  </subsection>
  <exercises>
    <title>Exercises</title>
      <exercise xml:id="exer-abstract-cft-finite-field">
        <statement>
          <p>
          Show that the hypotheses of abstract class field theory (i.e., the class field axiom and the conditions on a henselian valuation) are satisfied in the following case:
          <ul>
            <li>
              <p>
                <m>k</m> is a finite field and <m>\kbar</m> is its algebraic closure;
              </p>
            </li>
            <li>
              <p>
                <m>d: \Gal(\overline{k}/k) \to \widehat{\ZZ}</m> is the usual isomorphism;
              </p>
            </li>
            <li>
              <p>
                <m>A</m> is the group <m>\ZZ</m> with the trivial action;
              </p>
            </li>
            <li>
              <p>
                <m>v: A_k \to \widehat{\ZZ}</m> is the inclusion of <m>\ZZ</m> into its profinite completion.
              </p>
            </li>
          </ul>
          </p>
        </statement>
      </exercise>
      <exercise xml:id="exer-abstract-functorialities">
        <statement>
          Prove <xref ref="P_abstract_functorialities"/>.
        </statement>
      </exercise>
  </exercises>
</section>
